@startuml API Endpoint Schema and Data Contracts

title API Endpoints and Data Contract Specifications

package "REST API Endpoints" <<component>> {
    
    interface "POST /api/analyze" {
        note
          Request Body:
          {
            projectPath: string (path to Java project)
            includeHistory: boolean (optional, default: true)
          }
          
          Response (200):
          {
            status: 'success',
            analysisId: string (UUID),
            markdown: string (full documentation),
            pdfUrl: string (relative path to PDF),
            diagrams: [
              {
                name: string,
                url: string,
                type: 'class' | 'package' | 'sequence'
              }
            ],
            metadata: {
              projectName: string,
              totalClasses: number,
              totalMethods: number,
              totalPackages: number,
              fileCount: number,
              processingTimeMs: number
            },
            executionTimestamp: ISO 8601 datetime
          }
          
          Response (400):
          {
            status: 'error',
            error: string (validation error message),
            details: string[]
          }
          
          Response (500):
          {
            status: 'error',
            error: string (server error message),
            executionId: string (for debugging)
          }
        end note
    }
    
    interface "GET /api/history" {
        note
          Request Parameters: None
          
          Response (200):
          {
            status: 'success',
            history: [
              {
                id: string (analysisId),
                projectPath: string,
                projectName: string,
                timestamp: ISO 8601 datetime,
                status: 'success' | 'error',
                processingTimeMs: number,
                resultsUrl: string (link to results),
                errorMessage?: string (if status is error)
              }
            ]
          }
          
          Response (500):
          {
            status: 'error',
            error: string
          }
        end note
    }
    
    interface "GET /api/docs/:id" {
        note
          Path Parameters:
          - id: string (analysisId from previous /api/analyze call)
          
          Response (200):
          {
            status: 'success',
            analysisId: string,
            markdown: string,
            pdfUrl: string,
            diagrams: [ { name, url, type } ],
            metadata: { projectName, totalClasses, ... }
          }
          
          Response (404):
          {
            status: 'error',
            error: 'Analysis results not found'
          }
        end note
    }
}

package "Tool Call Request/Response Schema" <<component>> {
    
    interface "AI Tool Call (IMPLEMENTER)" {
        note
          Request to LMStudio:
          {
            role: 'user',
            content: string (prompt with file tree and extraction instructions)
          }
          
          Response from LMStudio:
          {
            tool_call_id: string,
            name: string ('grep_java_methods' | 'extract_classes' | ...),
            input: {
              pattern?: string,
              path?: string
            },
            output: {
              classes: [
                {
                  name: string,
                  package: string,
                  methods: [
                    {
                      name: string,
                      signature: string,
                      returnType: string,
                      parameters: [
                        { name: string, type: string }
                      ]
                    }
                  ],
                  fields: [
                    { name: string, type: string, visibility: string }
                  ],
                  superclass?: string,
                  interfaces: string[],
                  visibility: 'public' | 'protected' | 'private'
                }
              ],
              packages: [
                {
                  name: string,
                  classes: string[]
                }
              ],
              dependencies: [
                { from: string, to: string, type: 'extends' | 'implements' | 'uses' }
              ]
            }
          }
        end note
    }
    
    interface "Text Enrichment Response (EXPANDER)" {
        note
          Input to LMStudio:
          {
            role: 'user',
            content: string (prompt with raw class/method data and enrichment instructions)
          }
          
          Response from LMStudio:
          {
            enrichedMarkdown: string (formatted markdown with descriptions),
            classDescriptions: {
              [className]: string
            },
            methodDocumentation: {
              [className]: {
                [methodName]: string
              }
            },
            recommendations: [
              {
                class: string,
                suggestion: string,
                priority: 'high' | 'medium' | 'low'
              }
            ]
          }
        end note
    }
}

package "Validation Schemas" <<component>> {
    
    interface "ProjectPath Validation" {
        note
          Input: string (path)
          
          Checks:
          1. Path exists and is directory
          2. Contains at least one .java file
          3. Total size < 50 MB
          4. No symbolic links or junction points
          5. Read permissions verified
          
          Returns:
          {
            valid: boolean,
            javaFileCount: number,
            totalSizeMb: number,
            errors?: string[]
          }
        end note
    }
    
    interface "Tool Call Schema Validation" {
        note
          Validates AI response against schema:
          
          Required fields:
          - tool_call_id (string, UUID)
          - name (string, enum)
          - input (object, schema varies by tool)
          - output (object, matches expected structure)
          
          Returns:
          {
            valid: boolean,
            errors?: string[],
            warnings?: string[]
          }
        end note
    }
}

note bottom
  API Contract Notes:
  
  1. All timestamps use ISO 8601 format
  2. All errors include detailed error messages
  3. Analysis IDs are UUIDs for persistence
  4. PDF URLs are relative to /media/docs/
  5. Diagram URLs are relative to /diagrams/
  6. Processing can take 1-5 minutes for large projects
  7. All responses include execution metadata
  8. Tool calls are validated against JSON schemas before processing
end note

@enduml
