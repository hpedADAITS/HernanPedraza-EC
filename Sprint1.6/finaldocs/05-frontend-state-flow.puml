@startuml Frontend State Flow and Component Interaction

!define STATE_INITIAL #E1F5FF
!define STATE_LOADING #FFF3E0
!define STATE_SUCCESS #C8E6C9
!define STATE_ERROR #FFCCBC

title Frontend State Management and Component Interaction Flow

state "Initial State" as INITIAL <<START>> #E1F5FF {
    state "App Mount" {
        [*] --> FetchHistory
        FetchHistory --> HistoryReady
        HistoryReady --> RenderUI
    }
}

state "Project Selection" as PROJECT #BBDEFB {
    state "ProjectSelector Component" {
        RenderUI --> FileInput
        FileInput --> FileSelected
        FileSelected --> ValidateInput
    }
    
    ValidateInput --> Decision1: Is valid .java project?
    Decision1 --> Error1: ❌ No
    Decision1 --> SetSelectedProject: ✓ Yes
    Error1 --> ErrorState
    SetSelectedProject --> ReadyToGenerate
}

state "Generation Phase" as GENERATION #FFF3E0 {
    ReadyToGenerate --> GenerateButton
    GenerateButton --> ClickGenerate
    ClickGenerate --> SetLoading
    SetLoading --> ShowLoadingUI
    ShowLoadingUI --> PostAnalyzeRequest
}

state "API Communication" as API_COMM #F0F4C3 {
    PostAnalyzeRequest --> "Backend Processing"
    "Backend Processing" --> Decision2: Analysis complete?
    Decision2 --> ResponseSuccess: ✓ Success
    Decision2 --> ResponseError: ❌ Error
}

state "Success Path" as SUCCESS #C8E6C9 {
    ResponseSuccess --> ParseResponse
    ParseResponse --> SetResults
    SetResults --> SetHistoryNew
    SetHistoryNew --> RenderSuccess
    RenderSuccess --> ResultsView
}

state "ResultsView Component" as RESULTS {
    ResultsView --> DisplayMarkdown
    DisplayMarkdown --> ShowDiagrams
    ShowDiagrams --> DownloadOptions
    DownloadOptions --> DownloadMarkdown_
    DownloadOptions --> DownloadPDF_
}

state "Error Path" as ERROR_PATH #FFCCBC {
    ResponseError --> SetError
    SetError --> ErrorState: Error message set
    ErrorState --> LoadingState
    LoadingState --> ErrorDisplay
    ErrorDisplay --> RetryButton
    RetryButton --> Decision3: Retry?
    Decision3 --> "Project Selection": ✓ Yes
    Decision3 --> INITIAL: ❌ Cancel
}

state "History Tracking" as HISTORY #CCCCFF {
    HistoryView --> FetchHistory_
    FetchHistory_ --> DisplayTable
    DisplayTable --> TableRows
    TableRows --> RowItem: {timestamp, project, status}
}

state "Download Actions" as DOWNLOAD #E8F5E9 {
    DownloadMarkdown_ --> "Create blob(markdown)"
    "Create blob(markdown)" --> "Trigger download"
    DownloadPDF_ --> "Create link(pdfUrl)"
    "Create link(pdfUrl)" --> "Open or download"
}

' Transitions
INITIAL --> PROJECT
PROJECT --> GENERATION
GENERATION --> API_COMM
API_COMM --> SUCCESS
SUCCESS --> RESULTS
RESULTS --> DOWNLOAD
RESULTS --> HISTORY
HISTORY --> PROJECT: Reload history
ERROR_PATH --> HISTORY
ERROR_PATH --> PROJECT
DOWNLOAD --> PROJECT: New analysis

note right of INITIAL
  useState initialization:
  - selectedProject: null
  - isGenerating: false
  - results: { markdown: '', pdfUrl: '' }
  - error: ''
  - history: []
  
  useEffect on mount:
  - Fetch /api/history
end note

note right of PROJECT
  Props passed:
  - selectedProject
  - setSelectedProject
  - error
  - setError
  
  Validation:
  - File is .java or directory
  - Path contains valid files
end note

note right of GENERATION
  State updates:
  - setIsGenerating(true)
  - ShowLoadingState component
  - Display progress/spinner
end note

note right of API_COMM
  HTTP POST /api/analyze
  Body:
  {
    projectPath: string,
    timestamp: ISO datetime
  }
  
  Timeout: 2 minutes
  Retry logic: exponential backoff
end note

note right of SUCCESS
  Response structure:
  {
    status: 'success',
    markdown: string,
    pdfUrl: string,
    diagrams: [{ name, url }],
    processingTime: number
  }
end note

note right of RESULTS
  Props:
  - markdown: rendered as HTML
  - diagrams: <img> tags
  - pdfUrl: <iframe> + download
  
  Actions:
  - Copy markdown
  - Download as .md
  - Download as .pdf
  - View diagrams fullscreen
end note

note right of ERROR_PATH
  Error states:
  - Network timeout
  - Invalid project
  - Server error
  - No Java files found
  
  Display:
  - Error message in banner
  - Retry button
  - Clear history button
end note

note right of HISTORY
  Displays table:
  - Timestamp (recent first)
  - Project path
  - Status (success/failed)
  - Download links
  - Delete entry option
end note

@enduml
