@startuml Data Flow: Java Project to Documentation Pipeline

!define INPUT_BG #C8E6C9
!define PROCESS_BG #BBDEFB
!define OUTPUT_BG #FFE0B2
!define AI_BG #F0F4C3

title Data Flow Pipeline: From Java Repository to Complete Documentation

' Input phase
database "User Input\n(Java Project)" <<INPUT_BG>> {
    file "Local Directory\nor ZIP Archive"
}

database "File Upload\nEndpoint" <<PROCESS_BG>> {
    component "POST /api/analyze"
}

' Analysis phase
database "Analysis Phase" <<PROCESS_BG>> {
    component "FileTreeAnalyzer" #BBDEFB
    component "JavaParser" #BBDEFB
    component "ExtensionFinder\n(ext-finder.js)" #BBDEFB
}

' Data extraction
database "Extracted Data" <<OUTPUT_BG>> {
    component "File Tree Structure"
    component "Class List"
    component "Method Signatures"
    component "Package Hierarchy"
}

' AI Processing Phase
database "AI Processing\n(LMStudio)" <<AI_BG>> {
    component "IMPLEMENTER\n(Tool-call Analysis)"
    component "EXPANDER\n(Text Enrichment)"
}

' Intermediate results
database "Intermediate Output" <<OUTPUT_BG>> {
    component "Raw JSON Results"
    component "Tool Call Validation"
    component "Schema-validated Data"
}

' Documentation Generation
database "Documentation Generation" <<PROCESS_BG>> {
    component "PlantUML Generator" #BBDEFB
    component "Markdown Builder" #BBDEFB
    component "PDF Converter" #BBDEFB
}

' Final outputs
database "Final Outputs" <<OUTPUT_BG>> {
    file "/diagrams/*.puml"
    file "/diagrams/*.png"
    file "/media/docs/*.md"
    file "/media/docs/*.pdf"
}

' Storage
database "Persistent Storage" <<OUTPUT_BG>> {
    file "history.json\n(Execution Log)"
}

' Flow connections
"Local Directory\nor ZIP Archive" --> "POST /api/analyze" : User uploads
"POST /api/analyze" --> "FileTreeAnalyzer" : Triggers analysis
"FileTreeAnalyzer" --> "ExtensionFinder\n(ext-finder.js)" : Find Java files
"ExtensionFinder\n(ext-finder.js)" --> "JavaParser" : Supply file paths
"JavaParser" --> "File Tree Structure" : Build hierarchy
"JavaParser" --> "Class List" : Extract classes
"JavaParser" --> "Method Signatures" : Extract methods
"JavaParser" --> "Package Hierarchy" : Build packages

"File Tree Structure" --> "IMPLEMENTER\n(Tool-call Analysis)" : Provides context
"Class List" --> "IMPLEMENTER\n(Tool-call Analysis)" : Provides context
"Method Signatures" --> "IMPLEMENTER\n(Tool-call Analysis)" : Provides context
"Package Hierarchy" --> "IMPLEMENTER\n(Tool-call Analysis)" : Provides context

"IMPLEMENTER\n(Tool-call Analysis)" --> "Raw JSON Results" : Returns structures
"Raw JSON Results" --> "Tool Call Validation" : Validate against schema
"Tool Call Validation" --> "EXPANDER\n(Text Enrichment)" : Pass validated data
"EXPANDER\n(Text Enrichment)" --> "Schema-validated Data" : Enriched descriptions

"File Tree Structure" --> "PlantUML Generator" : Class relationships
"Class List" --> "PlantUML Generator" : Class names
"Method Signatures" --> "PlantUML Generator" : Method relationships

"Schema-validated Data" --> "Markdown Builder" : Enriched content
"Schema-validated Data" --> "PlantUML Generator" : Class diagrams

"PlantUML Generator" --> "/diagrams/*.puml" : PlantUML source
"PlantUML Generator" --> "/diagrams/*.png" : Rendered diagrams
"Markdown Builder" --> "/media/docs/*.md" : Documentation
"PDF Converter" --> "/media/docs/*.pdf" : Downloadable PDFs

"/media/docs/*.md" --> "history.json\n(Execution Log)" : Track execution
"/media/docs/*.pdf" --> "history.json\n(Execution Log)" : Track execution

@enduml
