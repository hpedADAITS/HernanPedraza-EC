<!doctype html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<title>Ejercicio 1 - Análisis y Transformación de Datos</title>
		<style>
			body {
				zoom: 1.5;
				font-family: "Segoe UI", sans-serif;
				background: linear-gradient(135deg, #eef2f3, #dfe9f3);
				display: flex;
				flex-direction: column;
				align-items: center;
				padding: 40px;
				min-height: 100vh;
				color: #222;
			}
			#button-container {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
				gap: 12px;
				width: 100%;
				max-width: 1000px;
				margin-bottom: 20px;
			}
			#button-container button {
				padding: 12px 20px;
				border: none;
				background: #0078d7;
				color: white;
				border-radius: 6px;
				cursor: pointer;
				font-size: 1rem;
				transition:
					background 0.3s,
					transform 0.1s;
				width: 100%;
				/* fill grid cell */
			}
			h2 {
				margin-bottom: 20px;
				color: #234;
				font-size: 1.6rem;
			}
			button {
				margin: 8px;
				padding: 12px 20px;
				border: none;
				background: #0078d7;
				color: white;
				border-radius: 6px;
				cursor: pointer;
				font-size: 1rem;
				transition:
					background 0.3s,
					transform 0.1s;
			}
			button:hover {
				background: #005fa3;
			}
			button:active {
				transform: scale(0.97);
			}
			.popup {
				position: fixed;
				inset: 0;
				display: flex;
				justify-content: center;
				align-items: center;
				background: rgba(0, 0, 0, 0.55);
				backdrop-filter: blur(3px);
				z-index: 1000;
			}
			.popup-content {
				position: relative;
				background: rgba(0, 0, 0, 0.85);
				border-radius: 10px;
				padding: 20px;
				max-width: 90%;
				max-height: 85%;
				overflow: auto;
				display: flex;
				flex-wrap: wrap;
				gap: 15px;
				justify-content: center;
				align-items: flex-start;
				color: #fff;
				animation: popupFadeScale 0.5s ease forwards;
			}
			@keyframes popupFadeScale {
				0% {
					opacity: 0;
					transform: scale(0.9);
				}
				100% {
					opacity: 1;
					transform: scale(1);
				}
			}
			.popup-item.kv {
				background: #1e2a38;
				border-radius: 8px;
				padding: 15px;
				width: 220px;
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 6px 10px;
				word-wrap: break-word;
				overflow-wrap: break-word;
				word-break: break-word;
			}
			.popup-item.single {
				background: #1e2a38;
				border-radius: 8px;
				padding: 15px;
				width: 220px;
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
				display: flex;
				justify-content: center;
				align-items: center;
				text-align: center;
				word-wrap: break-word;
				overflow-wrap: break-word;
				word-break: break-word;
			}
			.popup-item .key {
				font-weight: 600;
				color: #00bfff;
				overflow-wrap: break-word;
			}
			.popup-item .value {
				text-align: right;
				overflow-wrap: break-word;
				word-wrap: break-word;
				word-break: break-word;
			}
			.popup-close {
				position: absolute;
				top: 12px;
				right: 16px;
				font-size: 1.4rem;
				font-weight: bold;
				color: #fff;
				cursor: pointer;
				user-select: none;
				z-index: 1010;
			}
			.popup-close:hover {
				color: #ff4c4c;
			}
		</style>
	</head>
	<body>
		<h2>Ejercicio 1 - Análisis y Transformación Avanzada de Datos</h2>
		<div id="button-container">
			<button
				onclick="showResult(() => estudiantesDestacadosPorAsignatura(estudiantes, 'matematicas'))"
			>
				Estudiantes Destacados por Asignatura
			</button>
			<button
				onclick="showResult(() => asignaturaMenorRendimiento(estudiantes))"
			>
				Asignatura con Menor Rendimiento
			</button>
			<button onclick="showResult(() => mejoraNotasBeca(estudiantes))">
				Mejora de Notas para Estudiantes con Beca
			</button>
			<button
				onclick="showResult(() => filtrarPorCiudadYAsignatura(estudiantes, 'Madrid', 'fisica'))"
			>
				Filtrado por Ciudad y Asignatura
			</button>
			<button
				onclick="showResult(() => estudiantesSinBecaPorCiudad(estudiantes, 'Madrid'))"
			>
				Estudiantes Sin Beca por Ciudad
			</button>
			<button
				onclick="showResult(() => promedioEdadEstudiantesConBeca(estudiantes))"
			>
				Promedio de Edad de Estudiantes con Beca
			</button>
			<button onclick="showResult(() => mejoresEstudiantes(estudiantes))">
				Mejores Estudiantes en Total
			</button>
			<button
				onclick="showResult(() => estudiantesAprobados(estudiantes))"
			>
				Estudiantes con Todas las Materias Aprobadas
			</button>
		</div>
		<script src="estudiantes.js"></script>
		<script src="estudiantesDestacadosPorAsignatura.js"></script>
		<script src="asignaturaMenorRendimiento.js"></script>
		<script src="mejoraNotasBeca.js"></script>
		<script src="filtrarPorCiudadYAsignatura.js"></script>
		<script src="estudiantesSinBecaPorCiudad.js"></script>
		<script src="promedioEdadEstudiantesConBeca.js"></script>
		<script src="mejoresEstudiantes.js"></script>
		<script src="estudiantesAprobados.js"></script>
		<script>
			function showResult(fn) {
				let result;
				try {
					result = fn();
				} catch (err) {
					result = `⚠️ Error: ${err.message}`;
				}
				const overlay = document.createElement("div");
				overlay.className = "popup";
				const content = document.createElement("div");
				content.className = "popup-content";
				content.innerHTML = formatResult(result);
				const closeBtn = document.createElement("span");
				closeBtn.className = "popup-close";
				closeBtn.innerHTML = "&times;";
				closeBtn.onclick = () => overlay.remove();
				content.appendChild(closeBtn);
				overlay.appendChild(content);
				document.body.appendChild(overlay);
				function escHandler(e) {
					if (e.key === "Escape") {
						overlay.remove();
						document.removeEventListener("keydown", escHandler);
					}
				}
				document.addEventListener("keydown", escHandler);
			}
			function formatResult(val) {
				if (val === null || val === undefined)
					return `<div class='popup-item single'>N/A</div>`;
				if (Array.isArray(val))
					return val.map(item => formatResult(item)).join("");
				if (typeof val === "string" || typeof val === "boolean")
					return `<div class='popup-item single'>${val}</div>`;
				if (typeof val === "number") {
					let display = val % 1 === 0 ? val : val.toFixed(2);
					return `<div class='popup-item single'>${display}</div>`;
				}
				if (typeof val === "object") {
					let pairs = [];
					let hasKV = false;
					for (const [k, v] of Object.entries(val)) {
						if (v !== null && typeof v === "object") {
							for (const [nk, nv] of Object.entries(v)) {
								let display =
									typeof nv === "number"
										? nv % 1 === 0
											? nv
											: nv.toFixed(2)
										: nv;
								pairs.push(
									`<div class='key'>${nk}</div><div class='value'>${display}</div>`
								);
								hasKV = true;
							}
						} else {
							let display =
								typeof v === "number"
									? v % 1 === 0
										? v
										: v.toFixed(2)
									: v;
							pairs.push(
								`<div class='key'>${k}</div><div class='value'>${display}</div>`
							);
							hasKV = true;
						}
					}
					if (!hasKV)
						return `<div class='popup-item single'>${val}</div>`;
					return `<div class='popup-item kv'>${pairs.join("")}</div>`;
				}
			}
		</script>
	</body>
</html>
